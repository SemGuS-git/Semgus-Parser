/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/6.8.1/samples
 */

apply plugin: 'java'
apply plugin: 'antlr'

repositories {
    mavenCentral()
}

dependencies {
    antlr "org.antlr:antlr4:4.9.1"
    testImplementation "org.junit.jupiter:junit-jupiter-api:5.7.1", "org.junit.jupiter:junit-jupiter-params:5.7.0"
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:5.7.1"
}

test {
    useJUnitPlatform()
    dependsOn cleanTest
    testLogging {
        // The default parser tests print to STDERR on test failure
        showStandardStreams = true
    }
}

/*
 Handles copying the Semgus grammar file from the root to where Gradle expects it.
 The Semgus.g4 file is the main artifact of this repository, so no need to bury it.
*/
task copyGrammarFile(type: Copy) {
    from file("${projectDir}/Semgus.g4");
    into file("${projectDir}/src/main/antlr/org/semgus/parser/");
}
generateGrammarSource.dependsOn(copyGrammarFile);

generateGrammarSource {
    arguments += ['-package', 'org.semgus.parser']
}

/*
 Convenience task for running the ANTLR GUI test rig.
 Pass a filename with -Pfilename=<filename> on the command line.
*/
task checkGuiTree(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    classpath += configurations.antlr

    main = 'org.antlr.v4.gui.TestRig';
    args = [
        'org.semgus.parser.Semgus',
        'start',
        '-gui',
        findProperty('filename') ?: "" // Required for Gradle configuration to work
    ];
    doFirst {
        if (!findProperty('filename')) {
            throw new InvalidUserDataException("A filename is required. Pass -Pfilename=<filename> to Gradle.");
        }
    }
}
checkGuiTree.dependsOn(build)
